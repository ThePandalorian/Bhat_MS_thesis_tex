\section{An example in one dimension: The stochastic logistic equation}
Here, we analyze example \ref{ex_1D_stoch_logistic}. To recap, we had a population of individuals that exhibit a constant per-capita birth rate $\lambda > 0$, and a per-capita death rate that had the linear density-dependence $\mu + (\lambda-\mu)\frac{n}{K}$, where $\mu$ and $K$ are positive constants. Thus, we have the birth and death rates
\begin{equation}
\label{ex_1D_stoch_logistic_BD_eqns}
\begin{aligned}
    b(n) &= \lambda n\\
    d(n) &= \left(\mu + (\lambda-\mu)\frac{n}{K}\right)n
\end{aligned}
\end{equation}
Here, $K$ is the system-size parameter. Introducing the population density $x\coloneqq n/K$, we obtain
\begin{align*}
    b_K(x) &= \frac{1}{K}b(n) = \frac{1}{K}\lambda Kx\\
    d_K(x) &= \frac{1}{K}d(n) = \frac{1}{K}\left(\mu + (\lambda-\mu)\frac{Kx}{K}\right)Kx
\end{align*}
Thus, we have
\begin{equation*}
    A^{\pm}(x) = b_K(x)\pm d_K(x) = x\left(\lambda \pm \left(\left(\mu + (\lambda-\mu)x\right)\right) \right)
\end{equation*}
Defining $r=\lambda-\mu$ and $v=\lambda+\mu$ and using equation \eqref{1D_SDE}, we 
see that the `mesoscopic view' of the system is given by the solution of the SDE
\begin{equation}\label{ex_1D_stoch_logistic_full_SDE}
dX_t =  rX_t(1-X_t)dt + \sqrt{\frac{X_t(v+rX_t)}{K}}dW_t
\end{equation}
From equation \eqref{1D_det_limit}, we see that the deterministic dynamics are
\begin{equation}\label{ex_1D_stoch_logistic_det_limit}
\frac{dx}{dt} = A^-(x) = rx(1-x)
\end{equation}
showing that in the infinite population limit, we obtain the logistic equation. This derivation also makes it clear that two systems with very different stochastic dynamics can nevertheless converge to the same infinite population limit \eqref{ex_1D_stoch_logistic_det_limit}, since equation \eqref{ex_1D_stoch_logistic_det_limit} only depends on the difference $\lambda-\mu$.
\myfig{0.6}{figures/App_stoch_logistic_same_w_different_t.png}{\textbf{Comparison of time series produced by Gillespie simulations of the stochastic logistic equation for two different parameter values.} Simulations with the parameter values $\lambda = 4, \mu = 2$ are plotted in red, and simulations with the parameter values $\lambda = 31, \mu = 29$ are plotted in blue. Both simulations have $K=200$. The infinite population limit of both simulations is plotted in black dotted lines. The graph shows 10 realizations each for the two sets of parameter values.}{fig_1D_same_w_different_t_comparison}
To illustrate the effects of this seemingly innocent fact, figure \ref{fig_1D_same_w_different_t_comparison} compares two simulations which have the same value of $\lambda - \mu$ but a ten-fold difference in $\lambda+\mu$. As is clear from the figure, though both populations have the same behavior at the infinite population limit, populations with a higher value of $\lambda+\mu$ exhibit much wilder fluctuations and are therefore more prone to stochastic extinction. This is the root cause of the noise-induced selection that occurs in higher dimensions, discussed in detail in part \ref{part_summary}.

Letting $\alpha(t)$ be the solution of the logistic equation \eqref{ex_1D_stoch_logistic_det_limit}, We can Taylor expand $A^{\pm}(x)$ for the weak noise approximation, and we find:
\begin{align*}
A^-_1(x) &= \frac{d}{dx}(rx(1-x))\biggl{|}_{x=\alpha} = r(1 - 2\alpha(t))\\
A^+_0(x) &= \alpha(t)(v+r\alpha(t))
\end{align*}
Thus, the weak noise approximation of \ref{ex_1D_stoch_logistic_BD_eqns} is given by
\begin{equation}
    X_t = \alpha(t) + \frac{1}{\sqrt{K}}Y_t
\end{equation}
where the stochastic process $Y_t$ is an Ornstein-Uhlenbeck process given by the solution to the linear SDE
\begin{align}
    dY_t &= A^-_1(t)Y_tdt + \sqrt{A^+_0(t)}dW_t\nonumber\\
    \Rightarrow dY_t &= r(1 - 2\alpha(t))Y_tdt + \sqrt{\alpha(t)(v+r\alpha(t))}dW_t\label{ex_1D_stoch_logistic_WNA}
\end{align}
The time series predicted by these three processes look qualitatively similar and all seem to fluctuate about the deterministic steady state (Figure \ref{fig_1D_stoch_logistic_timeseries}).
\myfig{1}{figures/App_stoch_logistic_timeseries.png}{\textbf{Comparison of a single realization} of the exact birth-death process \eqref{ex_1D_stoch_logistic_BD_eqns}, the deterministic trajectory \eqref{ex_1D_stoch_logistic_det_limit}, the non-linear Fokker-Planck equation \eqref{ex_1D_stoch_logistic_full_SDE}, and the weak noise approximation \eqref{ex_1D_stoch_logistic_WNA} for \textbf{(A)} $K = 500$, \textbf{(B)} $K = 1000$, and \textbf{(C)} $K = 10000$. $\lambda = 2, \mu = 1$ for all thee cases.}{fig_1D_stoch_logistic_timeseries}
The deterministic trajectory \eqref{ex_1D_stoch_logistic_det_limit} has two fixed points, one at $x=0$ (extinction) and one at $x=1$ (corresponding to a population size of $n=K$). For $r > 0$, $x=0$ is unstable and $x=1$ is a global attractor, meaning in the deterministic limit, when $r > 0$, all populations end up at $x=1$ given enough time.\myfig{0.85}{figures/App_stoch_logistic_distributions.png}{\textbf{Comparison of the steady-state densities} given by \eqref{ex_1D_stoch_logistic_BD_eqns}, \eqref{ex_1D_stoch_logistic_full_SDE}, and \eqref{ex_1D_stoch_logistic_WNA} for \textbf{(A)} $K = 500$, \textbf{(B)} $K = 1000$, and \textbf{(C)} $K = 10000$. $\lambda = 2, \mu = 1$ for all thee cases. Each curve was obtained using $1000$ independent realizations.}{fig_1D_stoch_logistic_densities}
The stochastic dynamics \eqref{ex_1D_stoch_logistic_full_SDE} and \eqref{ex_1D_stoch_logistic_WNA}, however, depend not only on $r$, but also on $v$, the sum of the birth and death rates. It has been proven that $X_t = 0$ is the only recurrent state for the full stochastic dynamics \eqref{ex_1D_stoch_logistic_full_SDE}, meaning that every population is guaranteed to go extinct\footnote{This can be proven using tools from Markov chain theory. For those interested, the proof uses ergodicity to arrive at a contradiction if any state other than $0$ exhibits a non-zero density at steady state.} given enough time~\citep{nasell_extinction_2001}, thus illustrating an important difference between finite and infinite populations. $X_t = 0$ is also an `absorbing' state since once a population goes extinct, it has no way of being revived in this model. However, if $K$ is large enough, the eventual extinction of the population may take a very long time. In fact, we can make the expected time to extinction arbitrarily long by making $K$ sufficiently large. Thus, for moderately large values of $K$, it is biologically meaningful only to look at a weaker version of the steady state distribution by imposing the condition that the population does not go extinct and looking at the `transient' dynamics~\citep{hastings_transients_2004}.
Conditioned on non-extinction, the solution to \eqref{ex_1D_stoch_logistic_full_SDE} has a `quasistationary' distribution about the deterministic attractor $X_t = 1$, with some variance reflecting the effect of noise-induced fluctuations in population size~\citep{nasell_extinction_2001} due to the finite size of the population. The weak-noise approximation \eqref{ex_1D_stoch_logistic_WNA} implicitly assumes non-extinction by only measuring small fluctuations from the deterministic solution to \eqref{ex_1D_stoch_logistic_det_limit} and thus, at steady state, naturally describes a quasistationary distribution centered about $X_t = 1$. The steady-state density (probability density function as $t \to \infty$) of the exact birth-death process \eqref{ex_1D_stoch_logistic_BD_eqns} is compared with that predicted by \eqref{ex_1D_stoch_logistic_full_SDE} and \eqref{ex_1D_stoch_logistic_WNA} for various values of $K$ in figure \ref{fig_1D_stoch_logistic_densities}.

\section{An example for discrete traits: Lotka-Volterra and matrix games in finite populations}

The methods outlined in the above section have recently been used to study the population dynamics of a finite population playing a so-called `matrix game' (An evolutionary game for which you can write down a payoff matrix) with 2 pure strategies~\citep{tao_stochastic_2007}. Based on the interpretation of what each type represents, this is mathematically equivalent to studying frequency-dependent selection on a one-locus two-allele gene (with a bijective genotype-phenotype map and no mutations) or studying two-species competitive Lotka-Volterra dynamics, as we will show below. The stochastic Lotka-Volterra competition model shown below has also been proved to be equivalent to an $m$-allele Moran model under certain limits~\citep{constable_mapping_2017}.

Let us imagine a population with $m$ types of individuals that are interacting according to some ecological rules. Let the state of the population be characterized by the vector $\mathbf{n}(t) = [n_1(t),n_2(t),\ldots,n_m(t)]^{\mathrm{T}}$, where $n_i(t)$ is the number of type $i$ individuals at time $t$. Let the birth and death rates of the $i$th type be given by:
\begin{equation}
\label{nD_example_numbers_b_d_rates}
\begin{aligned}
b_i(\mathbf{n}) &= \left(\lambda + \frac{1}{K}\left(\sum\limits_{j=1}^{m}\beta_{ij}n_j\right)\right)n_i\\
d_i(\mathbf{n}) &= \left(\mu + \frac{1}{K}\left(\sum\limits_{j=1}^{m}\delta_{ij}n_j\right)\right)n_i
\end{aligned}
\end{equation}
where $K > 0$ is our system size parameter (and represents a global carrying capacity across all types), $\lambda > 0$ and $\mu > 0$ are suitable positive constants representing the baseline natality and mortality common to all types, and $\beta_{ij}$ and $\delta_{ij}$ are constants describing the effect of type $j$ individuals on the birth and death rate of type $i$ individuals respectively. The sign of $M_{ij} \coloneqq \beta_{ij} - \delta_{ij}$ determines whether type $j$ has a net positive or negative effect on the growth of type $i$. In ecological communities, this is a per-capita ecological interaction effect. In game-theoretic terms, we can interpret $M_{ij}$ as the payoff obtained by a type $j$ individual playing against a type $i$ individual. I assume that $| M_{ij} | \ll K$. The values $M_{ij}$ are often collected in an $m \times m$ matrix $\mathbf{M}$ called the `payoff matrix' (in evolutionary game theory) or `interaction matrix' (in Lotka-Volterra models). Lotka-Volterra models also frequently assume that the diagonal elements $M_{ii}$ are all equal, though I will not make that assumption here.

Going from population numbers $\mathbf{n}$ to densities $\mathbf{x} = \mathbf{n}/K$, we obtain the birth and death rates:
\begin{equation}
\label{nD_example_density_b_d_rates}
\begin{aligned}
b^{(K)}_i(\mathbf{x}) &= \left(\lambda + \sum\limits_{j=1}^{m}\beta_{ij}x_j\right)x_i\\
d^{(K)}_i(\mathbf{x}) &= \left(\mu + \sum\limits_{j=1}^{m}\delta_{ij}x_j\right)x_i
\end{aligned}
\end{equation}
Thus, we have
\begin{equation*}
A^{\pm}_{i} = x_i\left(\left(\lambda \pm \mu\right) + \sum\limits_{j=1}^{m}\left(\beta_{ij} \pm \delta_{ij}\right)x_j\right)
\end{equation*}
Defining $r \coloneqq \lambda - \mu$, $\nu \coloneqq \lambda + \mu$, and $T_{ij} \coloneqq \beta_{ij} + \delta_{ij}$, we see from equation \eqref{nD_Ito_SDE} that the mesoscopic view is the $m$ dimensional SDE given by
\begin{equation}
\label{nD_example_SDE}
d\mathbf{X}_{t} = \mathbf{A^-}(\mathbf{X}_t)dt + \frac{1}{\sqrt{K}}\mathbf{D}(\mathbf{X}_t)d\mathbf{W}_t
\end{equation}
where 
\begin{equation*}
\mathbf{A^-}_i = {(\mathbf{X}_{t})}_i(r + \sum\limits_{j=1}^{m}M_{ij}{(\mathbf{X}_{t})}_j) 
\end{equation*}
and
\begin{equation*}
(\mathbf{D}\mathbf{D}^{\mathrm{T}})_i = {(\mathbf{X}_{t})}_i(\nu + \sum\limits_{j=1}^{m}T_{ij}{(\mathbf{X}_{t})}_j) 
\end{equation*}
From \eqref{nD_det_limit}, we see that the deterministic limit is a set of $m$ coupled ODEs given by
\begin{equation}
\label{nD_example_det_limit}
\frac{d x_i}{dt} = x_i\left(r + \sum\limits_{j=1}^{m}M_{ij}x_j\right)
\end{equation}
These are precisely the Lotka-Volterra equations for a system of $m$ species. By matching the terms of \eqref{nD_example_density_b_d_rates} with those of \eqref{nD_functional_forms_for_replicator}, we can identify that we have $\mu = 0$ and
\begin{equation}
\label{nD_example_fitness}
w_i(\mathbf{x}) = r + \sum\limits_{j=1}^{m}M_{ij}x_j
\end{equation}
If $\mathbf{p}(t) = [p_1(t),\ldots,p_m(t)]^{\mathrm{T}}$ is the frequency vector at time $t$ and $N_K(t) = \sum_i x_i(t)$, then the mean fitness is given by
\begin{align}
\overline{w}(t) &= \sum\limits_{i=1}^{m}w_ip_i\\
&= \sum\limits_{i=1}^{m}\left(r + \sum\limits_{j=1}^{m}M_{ij}x_j\right)p_i\\
&= r + \sum\limits_{i=1}^{m}p_i\left(\sum\limits_{j=1}^{m}M_{ij}x_j\right)
\end{align}
where we have used the fact that $\sum_i p_i = 1$ in the last line. Using \eqref{nD_replicator_mutator} to write down the equations for the frequencies $p_i$, we obtain
\begin{equation}
\frac{1}{N_K(t)}\frac{dp_i}{dt} = \left[(\mathbf{Mp})_i - \mathbf{p}\cdot\mathbf{Mp}\right]p_i   
\end{equation}
which is the familiar version of the replicator equation seen in most textbooks, with an extra $N_K(t)$ factor to account for the fact that $\sum_i x_i$ is allowed to fluctuate in our model. If instead $N_K$ was a constant for all time, it could simply be absorbed into the definition of the payoff matrix $M$ to obtain exactly the replicator equation as presented in most ecology/evolution textbooks. Both the stochastic dynamics \eqref{nD_example_SDE} and the deterministic limit \eqref{nD_example_det_limit} can be simplified from an $m$ dimensional system to an $m-1$ dimensional system by a coordinate transformation that projects the dynamics onto an appropriate curve: If we go from the variables $x_1,\ldots,x_m$ to the variables $p_1,\ldots,p_{m-1},N_K$, we can exploit the fact that $N_K$ varies much less than the $p_i$ terms to project the system onto a `slow manifold' in which $N_K$ is approximately constant, thus obtaining an $m-1$ dimensional system of equations and recovering the relation between the Lotka-Volterra equations for $m$ species and the replicator equation for $m-1$ tactics~\citep{constable_mapping_2017,parsons_dimension_2017}. However, I will not explore such dimensional reduction techniques further in this manuscript, and refer the reader to~\cite{constable_stochastic_2013} and~\cite{parsons_dimension_2017} for a review of the ideas of (stochastic) dynamics on slow manifolds.

Let the solution to the equations \eqref{nD_example_det_limit} be given by $\mathbf{a}(t) = [a_1(t),\ldots,a_m(t)]^{\mathrm{T}}$. For the weak noise approximation, we can Taylor expand $A^{\pm}_i$ and use \eqref{nD_WNA_directional_derivative_for_replicator_eqns} to compute the directional derivative as:
\begin{align}
D_i &= y_iw_i(\mathbf{a}) + a_i\sum\limits_{k=1}^{m}y_k\left(\frac{\partial w_i}{\partial x_k}\bigg{|}_{\mathbf{x}=\mathbf{a}(t)}\right)\\
&= y_iw_i(\mathbf{a}) + a_i\sum\limits_{k=1}^{m}y_k\left(\frac{\partial}{\partial x_k}(r+\sum\limits_{j=1}^{m}M_{ij}x_j)\bigg{|}_{\mathbf{x}=\mathbf{a}(t)}\right)\\
&= y_iw_i(\mathbf{a}) + a_i\sum\limits_{k=1}^{m}y_kM_{ik}\\
\Rightarrow D_i &= y_iw_i(\mathbf{a}) + a_iw_i(\mathbf{y}) - ra_i\label{nD_example_directional_derivative}
\end{align}
where we have used the fact that $w_i(\mathbf{y}) = r + \sum\limits_{k=1}^{m}y_kM_{ik}$ (from \eqref{nD_example_fitness}) in the last step. Thus, in the weak noise approximation of our process, the dynamics are given by
\begin{equation}
\mathbf{x}(t) = \mathbf{a}(t) + \frac{1}{\sqrt{K}}\mathbf{y}(t)
\end{equation}
where the stochastic fluctuations $\mathbf{y}(t)$ satisfy the linear Fokker-Planck equation
\begin{equation}
\resizebox{1.1\textwidth}{!}{$\displaystyle\frac{\partial P}{\partial t}(\mathbf{y},t) = \sum\limits_{i=1}^{m}\left(-\frac{\partial}{\partial y_i}\left\{\left(y_iw_i(\mathbf{a}) + a_iw_i(\mathbf{y}) - ra_i\right)P(\mathbf{y},t)\right\}+\frac{1}{2}\left(a_i\left(\nu + \sum\limits_{j=1}^{m}T_{ij}a_j\right)\right)\frac{\partial^2}{\partial{y_i}^2}P(\mathbf{y},t)\right)$}
\end{equation}
Using \eqref{nD_example_directional_derivative} in \eqref{nD_moment_eqn_mean}, we see that the fluctuations are expected to evolve as:
\begin{equation}
\label{nD_example_moment_eqn_mean}
\frac{d}{dt}\mathbb{E}[y_i] = w_i(\mathbf{a})\mathbb{E}[y_i] + a_i\sum\limits_{k=1}^{m}M_{ik}\mathbb{E}[y_k]
\end{equation}
or, in matrix form:
\begin{equation}
\resizebox{0.93\textwidth}{!}{$\displaystyle
	\frac{d}{dt}\begin{bmatrix}
	\mathbb{E}[y_1]\\
	\mathbb{E}[y_2]\\
	\vdots\\
	\mathbb{E}[y_i]\\
	\vdots\\
	\mathbb{E}[y_m]
	\end{bmatrix}
	=
	\begin{bmatrix}
	(r + \sum\limits_{j=1}^{m}M_{1j}a_j + a_1M_{11}) & a_1M_{12} & a_1M_{13} & \dots & \dots & \dots & a_1M_{1m}\\
	a_2M_{21} & (r + \sum\limits_{j=1}^{m}M_{2j}a_j + a_2M_{22}) & a_2M_{23} & \dots & \dots & \dots & a_2M_{2m}\\
	\vdots &  & \ddots & &  & & \vdots\\
	a_{i}M_{i1} & a_iM_{i2} & a_iM_{i3} & \dots & (r + \sum\limits_{j=1}^{m}M_{ij}a_j + a_iM_{ii}) & \dots & a_iM_{im}\\
	\vdots &  &  & & & \ddots & \vdots\\
	a_mM_{m1} & a_mM_{m2} & a_mM_{m3} & \dots & \dots & \dots & (r + \sum\limits_{j=1}^{m}M_{mj}a_j + a_mM_{mm})
	\end{bmatrix}
	\begin{bmatrix}
	\mathbb{E}[y_1]\\
	\mathbb{E}[y_2]\\
	\vdots\\
	\mathbb{E}[y_i]\\
	\vdots\\
	\mathbb{E}[y_m]
	\end{bmatrix}
	$}
\end{equation}
The eigenvalues of the first matrix on the RHS will tell us whether the fixed point $\mathbb{E}[y_i] = 0 \ \forall \ i$ (the only fixed point of this system) is stable, or whether fluctuations are expected to grow (up to the point where the fluctuations are so large that the WNA is no longer valid). In the $m=2$ case,~\cite{tao_stochastic_2007} have shown that $\mathbb{E}[y_i] = 0 \ \forall \ i$ is a stable fixed point for this system iff the point $\mathbf{y}$ is an ESS (in the usual game-theoretic sense) for the matrix game defined by the payoff matrix $\mathbf{M}$.

\section{An example of noise-induced selection causing deviations from neutrality despite equal fitness}\label{App_deviation_from_neutrality}

To illustrate the biasing effects of noise-induced selection in otherwise neutral dynamics, I will use a simple 2 species Lotka-Volterra competition-like model where the effects of competition are on birth rates of one species but on the death rates of the other.

To motivate this, consider a community that contains two types of birds, say type 1 and type  2. These birds compete for limited resources, but in a peculiar manner: Though the two birds feed on different food sources, the trees that type 1 birds use for nesting are the same as those that the type 2 birds rely on for food. Both types are fiercely territorial and do not tolerate other individuals of either type on either their nesting or feeding sites. Thus, competition between the two types affects the \emph{birth rate} of type 1 birds (because they can't find good nesting sites) but the \emph{death rate} of type 2 birds (because of starvation), whereas intratype competition affects the death rate in both cases (due to competition for food sources). Occasionally, each type can give birth to babies of the other type due to mutations. Let us construct the simplest possible model for such a system.

Let each type of bird have a constant per-capita intrinsic birth rate (rate of birth of individuals, not rate at which individuals give birth) of 1 due to reproduction. Additionally, type 1 birds face a reduction in birth rates due to competition with type 2 birds. Let us assume that the magnitude of this competition (per-capita) is equal to the per-capita competition experienced from other individuals of the same type. Both types have some additional birth rate due to rare mutations of the other type, parameterized by a mutation rate $\mu > 0$. Let $n_i$ be the number of type $i$ individuals (which may vary over time). Assuming trees and birds are both randomly distributed through the landscape, we arrive at the birth rates
\begin{equation}
\label{App_example_stoch_LV_birth_rates}
\begin{aligned}
	b_{1}({n_1},{n_2}) &= {n_1} + \mu n_2 - \frac{{n_1}{n_2}}{K}\\
	b_{2}({n_1},{n_2}) &= {n_2} + \mu n_1
\end{aligned}
\end{equation}
Here, the ${n_1}{n_2}/K$ term represents the effect of competition between types; The product ${n_1}{n_2}$ quantifies how often a type 1 bird and a type 2 bird are expected to interact, and $K$ is a carrying capacity for the habitat (in analogy to logistic growth or Lotka-Volterra competition), and can be thought of as a proxy for the amount of tree cover in the landscape.

For the death rates, I assume that the effect of intra-type competition on the death rate is linearly density-dependent, and thus arrive at the equations:
\begin{equation}
\label{App_example_stoch_LV_death_rates}
\begin{aligned}
	d_{1}({n_1},{n_2}) &= \frac{{n_1^2}}{K}\\
	d_{2}({n_1},{n_2}) &= \frac{{n_2^2}}{K} + \frac{{n_1}{n_2}}{K}
\end{aligned}
\end{equation}
Note that the effect of competition between types manifests here in an increased death rate of type 2 birds due to starvation.

Moving to density space via the change of variables $x_i = n_i/K$, letting $\mathbf{x} = [x_1, x_2]^{\mathrm{T}}$, and comparing terms with equations \eqref{nD_functional_forms_for_replicator}, we can see that the per-capita fitness $w_i$ of each type is:
\begin{equation*}
	w_{1}(\mathbf{x}) = w_{2}(\mathbf{x}) = 1 - x_1 - x_2
\end{equation*}
The two types of birds have the same fitness! This implies that $w_1 = w_2 = \overline{w}$ and the selection term in \eqref{nD_replicator_mutator} vanishes.
However, if we now compute the per-capita turnover rates $\tau_i$  of each type, we see that we have
\begin{align*}
	\tau_{1}(\mathbf{x}) &= 1 + x_1 - x_2\\
	\tau_{2}(\mathbf{x}) &= 1 + x_1 + x_2
\end{align*}
Thus, $\tau_{1} < \tau_{2}$, and from equation \eqref{nD_stochastic_RM}, we know that this means noise-induced selection favors type 1 over type 2.

Direct simulations of the individual-based model indeed reveal that for low values of $K$, the fraction of individuals in the population that are of type 1 is significantly biased to be greater than 0.5, showing the effect of noise-induced selection (Figure \ref{App_stoch_LV_dens_plots}). This bias disappears for high values of $K$, as expected.
\myfig{1}{figures/App_stoch_LV_density_plots.png}{\textbf{(A)} Time series and \textbf{(B)} Density estimates for $p$, the fraction of type 1 individuals in the population for various values of $K$, obtained from a direct individual-based simulation of the model defined by equations \eqref{App_example_stoch_LV_birth_rates} and \eqref{App_example_stoch_LV_death_rates}, simulated via the (exact) Gillespie algorithm. Dotted lines are at $p=0.5$. At high $K$, the population conforms to deterministic (infinite population) predictions, but at low K, the distribution is biased towards $p > 0.5$. The time series are from single realizations. The density plots in panel $(B)$ are estimated from 100 independent realizations, each of which were run for $10^4$ timesteps. All simulations were initialized with $n_1 = n_2 = K/2$. In all simulations, $\mu = 0.05$.}{App_stoch_LV_dens_plots}

For this model, we can in fact quantitatively derive the effects of noise-induced selection by explicitly calculating each term of equation \eqref{nD_stochastic_RM}. Let $p = x_1/(x_1 + x_2)$ be the frequency of type 1 individuals and let $q = 1-p$. Then, it is easy to check by direct substitution of our functional forms that we have
\begin{align*}
	\overline{w} &= w_1(\mathbf{x}) = w_2(\mathbf{x})\\
	\overline{\tau} &= 1 + x_1 + x_2(q-p)\\
	\mu Q_i(\mathbf{p}) &= \mu p_{j}\textrm{ , where $i \neq j$}\\
	\mu(Q_1(\mathbf{p}) - p\left(\sum\limits_{j=1}^{2} Q_j(\mathbf{p})\right)) &= \mu(q-p)
\end{align*}
And thus, equation \eqref{nD_stochastic_RM} becomes
\begin{equation}
	\label{App_stoch_LV_RM_eqn}
	dp =  \left[\frac{2}{K}p^2q + \mu\left(1-\frac{1}{KN_K}\right)\left(q-p\right)\right]dt + q\sqrt{A^{+}_1}dW_t^{(1)} - p\sqrt{A^{+}_2}dW_t^{(2)}
\end{equation}
where $A_i^{+}$ is as defined throughout this thesis and each $W^{(i)}_t$ is an independent Wiener process. This equation clearly shows the biasing effect of noise-induced selection in the first component of the $dt$ term of the RHS. Since $p^2(1-p) > 0$ for $p \in (0,1)$, this term always tends to increase the fraction of type 1 individuals in the population. Note that the difference in fitness between the two types remains zero if every competition term (\emph{i.e.} every $n_in_j/K$ term) is multiplied by some constant $\alpha > 0$ parameterizing the strength of competition, meaning that the two types still have equal fitness. However, this constant affects the strength of noise-induced selection, and the corresponding term in equation \ref{App_stoch_LV_RM_eqn} becomes $2\alpha p^2q/K$ instead of $2p^2q/K$. Thus, for $\alpha > 1$, the strength of noise-induced selection (and thus the extent to which the distribution of types in the population is biased in favor of type 1 in plots like \ref{App_stoch_LV_dens_plots}) can be made arbitrarily high simply by modulating the strength of competition. The second component in the $dt$ term captures the effects of mutations, and simply reflects the fact that we assumed that $\textrm{(type }1) \to \textrm{(type }2)$ and $\textrm{(type }2) \to \textrm{(type }1)$ mutations occur at the same rate $\mu$, and thus, the net effect of mutational effects depends on the difference between the frequencies of the two types and flows towards the type with lower frequency. Finally, the two $dW^{(i)}_t$ terms are non-directional and vanish upon taking an expectation over the probability space, and therefore have no net contribution other than `blurring out the results' if we look at the dynamics averaged over many realizations.

\section{Interlude: Detecting modes in quantitative trait distributions through Fourier analysis}

In Chapter \ref{chap_infD_processes}, we used various approximations to arrive at the linear functional Fokker-Planck equation
\begin{equation}
\label{functional_WNE_for_App}
    \frac{\partial P}{\partial t}(\zeta,t) = \int\limits_{\mathcal{T}}\left(-\frac{\delta}{\delta \zeta(x)}\left\{\mathcal{D}_{\zeta}[\mathcal{A}^{-}](x)P(\zeta,t)\right\}+\frac{1}{2}\mathcal{A}^{+}(x|\psi)\frac{\delta^2}{\delta\zeta(x)^2}\{P(\zeta,t)\}\right)dx
\end{equation}
for describing stochastic fluctuations $\zeta$ from the deterministic solution obtained by solving \eqref{deterministic_traj}. Our goal is now to find a method to effectively detect and describe evolutionary branches (modes in trait space, corresponding to individual morphs) for this process. Following the methods used by Tim Rogers and colleagues for various special cases~\citep{rogers_demographic_2012, rogers_spontaneous_2012, rogers_modes_2015}, we will do this in a general manner by measuring the autocorrelation of the distribution of the population over trait space, a task made easier by moving to Fourier space.
\myfig{0.8}{figures/App_fourier_fig.png}{\textbf{Schematic description of Fourier analysis}. A function $\phi(x)$ (shown in red) over the trait space can be decomposed as the sum of infinitely many Fourier modes (shown in blue) $\phi_k$. In the Fourier dual space, we can look at the peaks of each of these Fourier modes: The magnitude of $\phi_k$ tells us how much it contributes to the actual function of interest $\phi$.}{fig_Fourier}
Specifically, a convenient theorem due to Weiner and Khinchin relates the autocorrelation of a probability distribution to its power spectral density via Fourier transformation. This has been extensively used in spatial ecology, and we too will make use of it here. We will thus restrict ourselves to cases in which we can express our focal function $\phi$ in terms of the Fourier basis $\{e^{ikx}\}_{k\in\mathbb{Z}}$ (Figure \ref{fig_Fourier}). For example, this can be done by restricting ourselves to cases where $\mathcal{T}$ is an interval with `periodic boundary conditions' (\emph{i.e.} we will extend all our functions from $\mathcal{T}$ to $\mathbb{R}$ in a way that they appear periodic with period given by the length of the interval $\mathcal{T}$). We may also need to restrict ourselves to a `nice' subspace of $\mathcal{M}(\mathcal{T})$, for example by intersecting with $L^2(\mathcal{T})$. In any case, we will assume all the prerequisites required for a Fourier basis expansion are satisfied. If $\mathcal{D}_{\zeta}[\mathcal{A}^{-}]$ is a translation-invariant\footnote{This is horrible nomenclature by the mathematicians. Though `invariant' is the conventional name for this concept, the intended meaning is not really invariant but `equivariant'. Formally, let $\mathcal{F}$ be a suitable function space of real valued functions. For any $c \in \mathbb{R}$, let $T_c: \mathcal{F} \to \mathcal{F}$ be the translation operator on this space, defined by $T_c[f(x)] = f(x+c)$. An operator $L: \mathcal{F} \to \mathcal{F}$ is said to be translation-invariant if it commutes with $T_c$ for every $c \in \mathbb{R}$, \emph{i.e.} $T_c[L[f]] = L[T_c[f]] \ \forall \ f \in \mathcal{F} \ \forall \ c \in \mathbb{R}$.} linear operator, then $\exp(ikx)$ acts as an eigenfunction, significantly simplifying the calculations. We therefore assume that $\mathcal{D}_{\zeta}[\mathcal{A}^{-}]$ takes the form:
\begin{equation*}
 \mathcal{D}_{\zeta}[\mathcal{A}^-](x,t) = L[\zeta(x,t)]   
\end{equation*}
for a translation-invariant linear operator $L$ that only depends on $x$ and $t$. This is not as restrictive as it initially sounds. For example, both the Laplacian operator and the convolution operator are linear and translation invariant. The presence of phenotypic clustering and polymorphisms can be analyzed by examining the power spectrum of $\Tilde{P}_{0}(\zeta,s)$ over the trait space, which is precisely what we will do.

As mentioned before, we assume that $\zeta$, and $\mathcal{A}^{+}(x|\psi)$ admit the Fourier basis representations:
\begin{equation}
\label{fourier_representations_functions}
\begin{aligned}
\zeta(x,t) &= \sum\limits_{k=-\infty}^{\infty}e^{ikx}\zeta_k(t) \ \ ; \ \ \zeta_k(t) = \int\limits_{\mathcal{T}}\zeta(x,t)e^{-ikx}dx\\
\mathcal{A}^{+}(x|\psi) &= \sum\limits_{k=-\infty}^{\infty}e^{ikx}A_k(t) \ \ ; \ \ A_k(t) = \int\limits_{\mathcal{T}}\mathcal{A}^{+}(x|\psi)e^{-ikx}dx
\end{aligned}
\end{equation}
In this case, the functional derivative operator obeys:
\begin{equation}
\label{fourier_representations_derivative}
    \frac{\delta}{\delta \zeta(x)} = \sum\limits_{k=-\infty}^{\infty}e^{-ikx}\frac{\partial}{\partial \zeta_k}
\end{equation}
and since $L$ is linear and translation-invariant, we also have the relation\footnote{This is because $\exp(ikx)$ acts as an eigenfunction for translation invariant linear operators, and therefore, for any function $\varphi = \sum\varphi_k\exp(ikx)$, we have the relation $L[\varphi] = L[\sum\varphi_k\exp(ikx)]=\sum\varphi_kL[\exp(ikx)]=\sum\varphi_kL_k\exp(ikx)$, where $L_k$ is the eigenvalue of $L$ associated with the eigenfunction $\exp(ikx)$. It is helpful to draw the analogy with eigenvectors of matrices and view $L_k\varphi_k$ as the projection of $L[\varphi]$ along the $k$th eigenvector $e_k = \exp(ikx)$.}:
\begin{equation}
\label{fourier_representation_linear_operator}
    L[\zeta] = \sum\limits_{k=-\infty}^{\infty}L_{k}\zeta_ke^{ikx}
\end{equation}
where 
\begin{equation*}
    L_k = e^{-ikx}L[e^{ikx}]
\end{equation*}
Lastly, by definition of Fourier modes, we have, for any differentiable real function $F$ and any fixed time $t > 0$:
\begin{equation}
\label{fourier_mode_relation}
\frac{\partial}{\partial \zeta_j(t)}F(\zeta_i(t)) = \delta_{ij}F'(\zeta_j(t))
\end{equation}
where $\delta_{ij}$ is the Kronecker delta symbol.
Using \eqref{fourier_representations_functions}, \eqref{fourier_representations_derivative}, and \eqref{fourier_representation_linear_operator} in \eqref{functional_WNE_for_App}, we get, for the first term of the RHS:
\begin{gather}
-\int\limits_{\mathcal{T}}\frac{\delta}{\delta \zeta(x)}\left\{L[\zeta(x,t)]P(\zeta,t)\right\}dx\nonumber\\
= -\int\limits_{\mathcal{T}}\sum\limits_{k}e^{-ikx}\frac{\partial}{\partial \zeta_k}\{\sum\limits_{n}e^{inx}L_n\zeta_nP\}dx\nonumber\\
= -\int\limits_{\mathcal{T}}\sum\limits_{k}\sum\limits_{n}e^{-i(k-n)x}\frac{\partial}{\partial \zeta_k}\{L_n\zeta_nP\}dx\nonumber\\
= -2\pi\sum\limits_{k}L_{k}\frac{\partial}{\partial \zeta_k}\{\zeta_kP\}\label{fourier_FPE_first_term}
\end{gather}
and for the second:
\begin{gather}
\int\limits_{\mathcal{T}}\sum\limits_{k}e^{ikx}A_k\left(\sum\limits_{m}\sum\limits_{n}e^{-i(m+n)x}\frac{\partial}{\partial \zeta_m}\frac{\partial}{\partial \zeta_n}P\right)dx\nonumber\\
= \int\limits_{\mathcal{T}}\sum\limits_{k}\sum\limits_{m}\sum\limits_{n}e^{i(k-m-n)x}A_k\frac{\partial}{\partial \zeta_m}\frac{\partial}{\partial \zeta_n}\{P\}dx\nonumber\\
= 2\pi\sum\limits_{m}\sum\limits_{n}A_{m+n}\frac{\partial}{\partial \zeta_m}\frac{\partial}{\partial \zeta_{n}}\{P\}\label{fourier_FPE_second_term}
\end{gather}
Substituting \eqref{fourier_FPE_first_term} and \eqref{fourier_FPE_second_term} into \eqref{functional_WNE_for_App}, we see that the Fokker-Planck equation \eqref{functional_WNE_for_App} in Fourier space reads:
\begin{equation}
\label{fourier_FPE}
\frac{\partial P}{\partial t} = -2\pi\sum\limits_{k}L_{k}\frac{\partial}{\partial \zeta_k}\{\zeta_kP\} + \pi\sum\limits_{m}\sum\limits_{n}A_{m+n}\frac{\partial}{\partial \zeta_m}\frac{\partial}{\partial \zeta_{n}}\{P\}
\end{equation}
It is important to remember that since $\zeta(x,t)$ is a stochastic process, $\zeta_i$ is really a stochastic process and thus $\zeta_i(t)$ is actually shorthand for the random variable $(\zeta_i)_{t}(\omega)$, where $\omega$ is a sample path in the Fourier dual of our original probability space. Multiplying both sides of \eqref{fourier_FPE} by $\zeta_r$ and integrating over the probability space to obtain expectation values, we see that
\begin{align}
\frac{d}{dt}\mathbb{E}[\zeta_r] &= - 2\pi \sum\limits_{k}\int\zeta_rL_k\frac{\partial}{\partial \zeta_k}\{\zeta_k P\}d\omega + \pi\sum\limits_{m}\sum\limits_{n}A_{m+n}\int\zeta_r\frac{\partial}{\partial \zeta_m}\frac{\partial}{\partial \zeta_{n}}(P)d\omega\nonumber\\
&=  2\pi \sum\limits_{k}L_k\int\zeta_k\frac{\partial \zeta_r}{\partial \zeta_k}Pd\omega + \pi\sum\limits_{m}\sum\limits_{n}A_{m+n}\int\frac{\partial^2 \zeta_r}{\partial \zeta_m\partial \zeta_{n}}Pd\omega\nonumber\\
&=  2\pi L_{r}\mathbb{E}[\zeta_r]\label{fourier_mode_mean}
\end{align}
where we have used integration by parts and neglected the boundary term in the second step (assuming once again that $P$ decays rapidly enough near the boundaries that this is doable), and then used \eqref{fourier_mode_relation} to arrive at the final expression. Similarly, multiplying \eqref{fourier_FPE} by $\zeta_r\zeta_s$, integrating over the probability space and using integration by parts, we get:
\begin{align}
\frac{d}{dt}\mathbb{E}[\zeta_r\zeta_s] &= 2\pi \sum\limits_{k}L_{k}\int\zeta_kP\frac{\partial}{\partial \zeta_k}\{\zeta_r\zeta_s\}d\omega + \pi\sum\limits_{m}\sum\limits_{n}A_{m+n}\int\limits_{-\infty}^{\infty}P\frac{\partial}{\partial \zeta_m}\frac{\partial}{\partial \zeta_{n}}\{\zeta_r\zeta_s\}d\omega\nonumber\\
&= 2\pi (L_{r} + L_{s})\mathbb{E}[\zeta_r\zeta_s] + \pi (A_{2r}+A_{2s})\label{fourier_mode_covariance}
\end{align}
At the stationary state, the LHS must be zero by definition, and we must therefore have, for every $r,s \in \mathbb{Z}$,:
\begin{equation}
\label{fourier_mode_covariance_stationary}
\mathbb{E}[\zeta_r\zeta_s] = -   \frac{A_{2r}+A_{2s}}{2(L_{r}+L_{s})}
\end{equation}
Recall that the Fourier modes of any real function $\varphi$ must satisfy $\varphi_{-r} = \overline{\varphi}_r$. Since $\zeta$, $A$ and $L$ are all real, we can substitute $s=-r$ in equation \eqref{fourier_mode_covariance_stationary} to obtain the autocovariance relation:
\begin{equation}
\label{fourier_mode_autocovariance}
\mathbb{E}[|\zeta_r|^2] =- \frac{\mathrm{Re}(A_{2r})}{2\mathrm{Re}(L_{r})}
\end{equation}

The presence of phenotypic clustering can be detected using the `spatial covariance' of our original process $\phi$, defined as~\citep{rogers_demographic_2012}:
\begin{equation}
\label{spatial_covariance_defn}
\Xi[x] = m(\mathcal{T})\int\limits_{\mathcal{T}}\mathbb{E}[\phi_{\infty}(x)\phi_{\infty}(y-x)]dy
\end{equation}
where $\phi_{\infty}$ is the stationary state distribution of $\{\phi_t\}_{t}$ and $m$ is the Lebesgue measure. We can use a spatial analogue of the Wiener-Khinchin theorem to calculate:
\begin{equation}
\label{spatial_covariance_zeta}
\Xi[x] = m(\mathcal{T})\left[\int\limits_{\mathcal{T}}\psi_{\infty}(x)\psi_{\infty}(y-x)dy + \frac{1}{K}\sum\limits_{r=-\infty}^{\infty}\mathbb{E}[|\zeta_r|^2]e^{irx}\right]
\end{equation}
where the expectations in the second term are for the stationary state. A flat $\Xi[x]$ indicates that there are no clusters, and peaks indicate the presence of clusters.

\section{An example for quantitative traits: The quantitative logistic equation}
Recall the birth and death functionals given by \eqref{Rogers_logistic_BD}. That is, the functionals
\begin{equation}
\begin{aligned}
b(x|\nu) &= r\int\limits_{\mathcal{T}}m(x,y)\nu(y)dy; \ m(x,y) = \exp\left(\frac{-(x-y)^2}{\sigma_{m}^{2}}\right)\\
d(x|\nu) &= \frac{\nu(x)}{Kn(x)}\int\limits_{\mathcal{T}}\alpha(x,y)\nu(y)dy; \ \alpha(x,y) = \exp\left(\frac{-(x-y)^2}{\sigma_{\alpha}^{2}}\right)
\end{aligned}
\end{equation}
corresponding to an asexual population having a constant (per-capita) birth rate $r$ and mutations controlled by a Gaussian kernel $m(x,y)$. The death rate is density-dependent, mediated by a Gaussian competition kernel $\alpha(x,y)$, and also contains a phenotype-dependent carrying capacity controlled by $n(x)$, scaled by a constant $K$. The biological interpretation of the death rate is through ecological specialization for limiting resources - Individuals have different intrinsic advantages (controlled by $n(x)$), and experience greater competition from conspecifics that are closer to them in phenotype space (controlled by $\alpha(x,y)$). In terms of the scaled variable $\phi = K\nu$, these functions read:
\begin{equation}
\label{Rogers_logistic_BD_scaled}
\begin{aligned}
b_K(x|\phi) &= \frac{1}{K}b(x|\nu) = \frac{1}{K}\left( r\int\limits_{\mathcal{T}}m(x,y)K\phi(y)dy\right)\\
    d_K(x|\phi) &= \frac{1}{K}d(x|\nu) =  \frac{1}{K}\left(\frac{K\phi(x)}{Kn(x)}\int\limits_{\mathcal{T}}\alpha(x,y)K\phi(y)dy\right)
\end{aligned}
\end{equation}
Thus, using equation \eqref{deterministic_traj}, the deterministic trajectory becomes:
\begin{equation}
\label{Rogers_logistic_BD_deterministic}
\frac{\partial \psi}{\partial t}(x,t) = r\int\limits_{\mathcal{T}}m(x,y)\psi(y,t)dy-\frac{1}{n(x)}\psi(x,t)\int\limits_{\mathcal{T}}\alpha(x,y)\psi(y,t)dy
\end{equation}
Note that if we employ the change of variables $\Psi = K\psi$ to go back from $\mathcal{M}_{K}$ (\textit{i.e} $\phi^{(t)}$) to $\mathcal{M}$ (\textit{i.e} $\nu^{(t)}$), we recover the familiar quantitative logistic equation as the deterministic limit:
\begin{align*}
\frac{\partial \Psi}{\partial t}(x,t) &= r\int\limits_{\mathcal{T}}m(x,y)\Psi(y,t)dy-\frac{\Psi(x,t)}{Kn(x)}\int\limits_{\mathcal{T}}\alpha(x,y)\Psi(y,t)dy \\
&\approx r\Psi(x,t) -\frac{\Psi(x,t)}{K(x)}\int\limits_{\mathcal{T}}\alpha(x,y)\Psi(y,t)dy + D_m\nabla^2_{x}\Psi(x,t)
\end{align*}
where $K(x) = Kn(x)$ is the carrying capacity experienced by an individual of phenotype $x$, and $D_m = r \sigma_m^2/2$ measures the `diffusion rate' of the population in trait space.

We can also calculate $\mathcal{D}_{\zeta}[\mathcal{A}^-]$ as
\begin{align*}
\mathcal{D}_{\zeta}[\mathcal{A}^-] &= \frac{d}{d\epsilon}\left( r\int\limits_{\mathcal{T}} m(x,y)(\psi(y)+\epsilon\zeta(y))dy - \frac{\psi(x)+\epsilon\zeta(x)}{n(x)}\int\limits_{\mathcal{T}}\alpha(x,y)(\psi(y)+\epsilon\zeta(y))dy\right) \biggl{|}_{\epsilon = 0}\\
&= r\int\limits_{\mathcal{T}}m(x,y)\zeta(y)dy - \frac{1}{n(x)}\left(\psi(x)\int\limits_{\mathcal{T}}\alpha(x,y)\zeta(y)dy + \zeta(x)\int\limits_{\mathcal{T}}\alpha(x,y)\psi(y)dy\right)
\end{align*}
Using this in equation \eqref{spatial_covariance_zeta},
\cite{rogers_demographic_2012} (and later~\cite{rogers_modes_2015}) have shown that the contribution of demographic stochasticity can lead to inhibition of branching, and thus, while the population undergoes infinitely many branching events in the infinite population prediction, this does not happen for finite populations.
\myfig{0.8}{figures/App_dem_stoch_effects.png}{\textbf{Effect of population size on evolutionary branching}. Two different realizations of the system \eqref{Rogers_logistic_BD} with $n(x) = \exp(-x^2/\sigma_{K}^2)$. Simulation parameters are $\sigma_{K} = 1.9, \sigma_{\alpha} = 0.7, \sigma^2_{m} = 0.05$ for \textbf{top:} $K = 1000$ and \textbf{bottom:} $K = 10000$. Each point represents an individual. Note that the model on top remains monomorphic whereas the model on the bottom exhibits evolutionary branching, where an initially monomorphic population evolves to become dimorphic.}{fig_dem_stoch}
An alternative `moment-based' method that avoids moving to Fourier space has also been used to study this phenomenon of evolutionary branching and clustering in finite populations~\citep{wakano_evolutionary_2013,debarre_evolutionary_2016}. These studies use the equation we derived in section \ref{sec_fun_theorems_var} for the variance of the trait in the population and compute the conditions required for the variance to `explode' (Equation A.23 in~\cite{debarre_evolutionary_2016} is exactly equivalent to equation \eqref{nD_stochastic_Price_variance} for their choice of functional forms upon converting their change in variance to an infinitesimal rate of change \emph{i.e.} a derivative). The method itself is relatively straightforward in principle (complications arise if the particular models are complicated) and I therefore do not explore it further in this thesis, but the broad results of such moment-based approaches is in agreement with the predictions made from the spectral methods employed in~\cite{rogers_demographic_2012} and~\cite{rogers_modes_2015}.

It is left as an exercise for the reader to verify by the same steps that if we instead have the birth rate functional $b(x|\phi) = \lambda\int m(x,y)\phi(y)dy$ (with $m(x,y)$ as defined in \eqref{Rogers_logistic_BD}) and the death rate functional $d(x|\phi) = \phi(x)\left(\mu+(\lambda-\mu)\phi(x)/K\right)$, the infinite-population limit yields the famous Fisher-KPP equation with growth rate $r=\lambda-\mu$ and diffusion constant $D = \lambda \sigma_m^2/2$.